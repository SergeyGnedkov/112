# Top-Down 2D Game Scripts

Набор скриптов для создания 2D Top-Down игры в стиле Hotline Miami.

## Описание скриптов

### PlayerController.cs
Скрипт управления игроком:
- Передвижение на WASD
- Бег при нажатии Shift
- Поворот персонажа за курсором мыши
- Плавное движение с использованием Rigidbody2D

### DoorController.cs
Скрипт для дверей:
- Автоматическое открытие при приближении игрока
- Определение стороны, с которой подходит игрок
- Плавное открытие/закрытие
- Настраиваемые параметры открытия

### FireSystem.cs
распространение огня:
- Настраиваемый интервал появления огня
- Постепенный рост эффекта огня
- Нанесение урона игроку в зоне действия
- Визуальные эффекты
- Система распространения огня с учетом препятствий
- Урон зависит от расстояния до центра огня
- Возможность тушения огня

### StudentAI.cs
ИИ студентов:
- Случайное перемещение по уровню
- Следование за игроком при нажатии E
- Избегание препятствий
- Настраиваемые параметры движения

### LevelExitZone.cs
выход из уровня:
- Переход в меню при входе игрока
- Опциональная проверка всех спасенных студентов
- Настраиваемая задержка перехода

### PlayerHealth.cs
здоровье игрока:
- Система урона и лечения
- Автоматическая регенерация здоровья
- События для UI и эффектов
- Система смерти с перезагрузкой уровня
- Визуальная обратная связь при получении урона
- Настраиваемое сопротивление урону от огня

## Подробное описание компонентов

### PlayerHealth
Система здоровья игрока включает:
- Перезагрузку сцены при смерти
- Визуальный эффект получения урона (мигание красным)
- Параметр fireResistance для настройки сопротивления урону от огня
- Задержку перед перезагрузкой для эффектов смерти
- Автоматическую регенерацию здоровья
- События для UI и визуальных эффектов

### FireSystem
Система огня включает:
- Систему тиков урона (damageTickRate)
- Урон зависит от расстояния до центра огня
- Прямой контакт с огнем через OnTriggerStay2D
- Улучшенный расчет урона с учетом времени
- Систему распространения с учетом препятствий
- Возможность тушения огня

### StudentAI
Улучшенная система ИИ студентов включает:
- Умное следование за игроком
- Система избегания препятствий
- Плавное движение и повороты
- Автоматическое обнаружение игрока
- Телепортацию при большом отдалении
- Визуальные эффекты для обратной связи

### LevelExitZone
Система перехода между уровнями включает:
- Автоматический переход на следующую сцену
- Возможность указать конкретную сцену для перехода
- Проверку наличия всех студентов
- Визуальные эффекты перехода
- Настраиваемую задержку
- Визуализацию в редакторе

## Детальная настройка компонентов

### Настройка PlayerHealth
1. Основные параметры:
   - maxHealth = 100 (максимальное здоровье)
   - healthRegenRate = 5 (скорость восстановления)
   - regenDelay = 3 (задержка до начала восстановления)
   - fireResistance = 1 (или меньше для большей защиты от огня)
   - damageFlashDuration = 0.2 (длительность мигания при уроне)

2. Необходимые компоненты:
   - SpriteRenderer (для визуальных эффектов урона)
   - Collider2D (Is Trigger = true)
   - Правильный Layer (тот же, что указан в playerLayer в FireSystem)

3. События:
   - onDeath - вызывается при смерти
   - onHealthChanged - вызывается при изменении здоровья
   - onDamageTaken - вызывается при получении урона

### Настройка FireSystem
1. Параметры урона:
   - damagePerSecond = 25 (базовый урон в секунду)
   - damageRadius = 1.5 (радиус нанесения урона)
   - damageTickRate = 0.2 (частота нанесения урона)

2. Параметры распространения:
   - spreadInterval = 1.5 (интервал между попытками распространения)
   - spreadRadius = 2 (максимальное расстояние распространения)
   - spreadChance = 0.7 (базовый шанс распространения)
   - maxFireCount = 50 (максимальное количество точек огня)

3. Визуальные параметры:
   - fadeSpeed = 2 (скорость затухания при тушении)
   - startScale = 1 (начальный размер огня)
   - growthSpeed = 2 (скорость роста огня)

4. Настройка слоев:
   - playerLayer = слой игрока
   - obstacleLayer = слой препятствий

5. Физические компоненты:
   - Rigidbody2D:
     * gravityScale = 0
     * isKinematic = true
     * Freeze Position/Rotation = true
   - Collider2D:
     * Is Trigger = true

### Настройка StudentAI
1. Параметры движения:
   - moveSpeed = 3 (скорость обычного движения)
   - followSpeed = 4 (скорость следования за игроком)
   - rotationSpeed = 5 (скорость поворота)
   - wanderRadius = 5 (радиус случайного движения)
   - avoidanceRadius = 1.5 (радиус избегания препятствий)
   - minWanderWaitTime = 1 (мин. время ожидания)
   - maxWanderWaitTime = 3 (макс. время ожидания)

2. Параметры следования:
   - followDistance = 2 (дистанция следования)
   - interactionRadius = 3 (радиус взаимодействия с клавишей E)
   - maxFollowDistance = 10 (макс. дистанция до телепортации)
   - teleportOffset = 1 (отступ при телепортации)
   - pathUpdateRate = 0.2 (частота обновления пути)

3. Визуальные эффекты:
   - teleportFlashDuration = 0.2 (длительность вспышки)
   - teleportFlashColor = Color.cyan (цвет телепортации)
   - showDebugGizmos = true (отображение отладки)

4. Необходимые компоненты:
   - Rigidbody2D:
     * gravityScale = 0
     * freezeRotation = true
   - Collider2D (для определения препятствий)
   - SpriteRenderer (для визуальных эффектов)

### Настройка LevelExitZone
1. Основные параметры:
   - transitionDelay = 1 (задержка перед переходом)
   - requireAllStudents = true (требовать всех студентов)
   - useNextScene = true (использовать следующую сцену)
   - specificSceneName = "" (имя конкретной сцены)

2. Визуальные эффекты:
   - showExitGizmo = true (показывать в редакторе)
   - gizmoColor = Color.green (цвет в редакторе)
   - transitionEffectPrefab = null (эффект перехода)

3. Необходимые компоненты:
   - BoxCollider2D:
     * Is Trigger = true
     * Size подходящая для зоны выхода

## Особенности работы системы

### Система урона
- Урон от огня зависит от расстояния до его центра
- При прямом контакте наносится максимальный урон
- Урон применяется с учётом сопротивления игрока (fireResistance)
- Визуальная обратная связь при получении урона

### Система восстановления
- Здоровье начинает восстанавливаться после указанной задержки
- Восстановление прерывается при получении нового урона
- Скорость восстановления настраивается через healthRegenRate

### Система смерти
- При нулевом здоровье активируется последовательность смерти
- Вызываются соответствующие события
- После короткой задержки происходит перезагрузка уровня

### Система движения студентов
- Плавное ускорение и замедление
- Умное избегание препятствий
- Естественные повороты в направлении движения
- Случайное перемещение в режиме ожидания

### Система следования
- Активация/деактивация по клавише E
- Автоматическая телепортация при большом расстоянии
- Плавное следование за игроком
- Умное обхождение препятствий

### Система перехода между уровнями
- Автоматическое определение следующей сцены
- Проверка наличия всех студентов перед переходом
- Возможность указать конкретную сцену
- Визуальные эффекты при переходе
- Возврат к первой сцене после последнего уровня

### Визуальные эффекты
- Вспышка при телепортации
- Отображение радиусов в редакторе
- Визуализация пути до игрока

## Инструкция по настройке

### Настройка игрока
1. объект игрока и добавьте компоненты:
   - PlayerController
   - PlayerHealth (настройте параметры):
     * maxHealth = 100
     * healthRegenRate = 5
     * regenDelay = 3
     * fireResistance = 1.0
     * damageFlashDuration = 0.2
   - Rigidbody2D (с параметром Freeze Rotation)
   - Collider2D (Is Trigger = true для определения урона)
   - SpriteRenderer (для визуальных эффектов урона)

### Настройка дверей
1. объекты с компонентами:
   - DoorController
   - Rigidbody2D
   - BoxCollider2D

### Настройка системы огня
1. Создайте префаб огня:
   - Добавьте FireSystem компонент
   - Настройте параметры Fire Settings:
     * spreadInterval = 1.5
     * spreadRadius = 2
     * spreadChance = 0.7
     * maxFireCount = 50
   - Настройте Visual Settings:
     * fadeSpeed = 2
     * startScale = 1
     * growthSpeed = 2
   - Настройте Damage Settings:
     * damagePerSecond = 25
     * damageRadius = 1.5
     * damageTickRate = 0.2
   - Добавьте Rigidbody2D:
     * gravityScale = 0
     * isKinematic = true
     * Freeze Position/Rotation = true
   - Добавьте Collider2D:
     * Is Trigger = true
   - Добавьте SpriteRenderer с подходящим спрайтом огня
2. Настройте слои:
   - Создайте слой для игрока и назначьте его в playerLayer
   - Создайте слой для препятствий и назначьте его в obstacleLayer

### Настройка студентов
1. Создай префаб с компонентами:
   - StudentAI
   - Rigidbody2D
   - Collider2D

### Настройка зоны выхода
1. Создай объект с:
   - LevelExitZone
   - BoxCollider2D (Is Trigger = true)

## Важные замечания

- убедись в одном. то что все обьекты находятся на слоях для корректной работы физики
- поставь теги для игрока ("Player") и других объектов
- Для работы дверей и ИИ настрой слои препятствий
- Настрой события в PlayerHealth для обработки урона и смерти
- Для системы огня убедитесь, что:
  * Все коллайдеры настроены как триггеры
  * Слои игрока и препятствий правильно назначены
  * Огонь находится на правильном Z-уровне (0 для 2D)

## Настройка в Unity

1. Создайте префаб студента:
   - Добавьте базовые компоненты:
     * StudentAI скрипт
     * Rigidbody2D (настройте как указано выше)
     * Collider2D (для определения столкновений)
     * SpriteRenderer (для визуализации)

2. Настройте параметры в инспекторе:
   - Movement Settings:
     * Установите скорости движения
     * Настройте радиусы действия
     * Установите слой препятствий
   - Following Settings:
     * Настройте дистанции следования
     * Установите параметры телепортации
   - Visual Effects:
     * Настройте эффекты телепортации
     * При необходимости включите отладку

3. Настройка слоев:
   - Создайте слой для препятствий
   - Назначьте его всем объектам-препятствиям
   - Укажите слой в obstacleLayer

4. Тестирование:
   - Разместите студента на сцене
   - Убедитесь, что игрок имеет тег "Player"
   - Проверьте работу следования клавишей E
   - Настройте радиусы под размер вашего уровня

### Настройка зоны выхода
1. Создайте объект с компонентами:
   - LevelExitZone скрипт
   - BoxCollider2D (Is Trigger = true)

2. Настройте параметры в инспекторе:
   - Exit Settings:
     * Установите задержку перехода
     * Выберите режим перехода (следующая/конкретная сцена)
     * При необходимости укажите имя сцены
   - Visual Effects:
     * Настройте отображение в редакторе
     * Добавьте префаб эффекта перехода

3. Добавьте сцены в Build Settings:
   - Откройте Build Settings (File -> Build Settings)
   - Добавьте все сцены в нужном порядке
   - Убедитесь, что порядок сцен правильный

4. Тестирование:
   - Проверьте переход между сценами
   - Убедитесь, что проверка студентов работает
   - Настройте размер зоны выхода 

## Система подсчета очков и управления уровнями

### GameManager
Глобальный менеджер игры, управляющий очками и временем:

1. Основные параметры:
   - pointsPerStudent = 100 (очки за каждого спасенного студента)
   - useTimeBonus = true (использовать бонус за время)
   - timeBonusThreshold = 60 (порог времени для получения бонуса в секундах)
   - timeBonus = 50 (дополнительные очки за быстрое прохождение)

2. Необходимые настройки:
   - Создайте пустой объект GameManager в сцене
   - Добавьте компонент GameManager
   - Установите "DontDestroyOnLoad" для сохранения между сценами

3. UI элементы (ссылки на Text компоненты):
   - scoreText (для отображения очков)
   - timerText (для отображения времени)
   - savedStudentsText (для отображения количества спасенных)

### GameUI
Управление отображением игровой статистики:

1. Компоненты UI:
   - Создайте Canvas в сцене
   - Добавьте Panel для статистики
   - Создайте Text элементы:
     * Score: для очков
     * Time: для времени уровня
     * Saved: для количества спасенных студентов

2. Настройка GameUI:
   - Добавьте скрипт GameUI на Canvas
   - Настройте ссылки на Text компоненты
   - Параметры анимации:
     * scoreUpdateSpeed = 0.5 (скорость обновления очков)
     * bonusScoreColor = Color.yellow (цвет бонусных очков)

### Взаимодействие компонентов

1. GameManager и LevelExitZone:
   - При входе в зону выхода проверяется количество спасенных студентов
   - Очки начисляются за каждого спасенного
   - Бонус за время добавляется при быстром прохождении
   - Статистика сохраняется между уровнями

2. GameManager и StudentAI:
   - Подсчет следующих за игроком студентов
   - Обновление UI при спасении каждого студента
   - Проверка условий для перехода на следующий уровень

3. Система бонусов:
   - Базовые очки: количество спасенных × pointsPerStudent
   - Временной бонус: +timeBonus если уровень пройден быстрее timeBonusThreshold
   - Общий счет сохраняется между уровнями

### Порядок настройки

1. Настройка GameManager:
   ```
   GameObject (GameManager)
   └── GameManager (Script)
       ├── Points Per Student = 100
       ├── Use Time Bonus = true
       ├── Time Bonus Threshold = 60
       └── Time Bonus = 50
   ```

2. Настройка UI:
   ```
   Canvas
   └── Stats Panel
       ├── Score Text
       ├── Timer Text
       └── Saved Students Text
   ```

3. Связывание компонентов:
   - Перетащите Text компоненты в соответствующие поля GameManager
   - Убедитесь, что Canvas находится в сцене
   - Проверьте, что GameManager существует в первой сцене

4. Проверка работы:
   - Запустите игру
   - Проверьте отображение статистики
   - Убедитесь, что очки сохраняются между уровнями
   - Проверьте начисление бонусов за время

### Советы по настройке

1. Оптимизация UI:
   - Используйте объект Stats Panel для группировки элементов
   - Настройте якоря (anchors) для правильного масштабирования
   - Добавьте анимации для изменения очков

2. Настройка сложности:
   - Регулируйте pointsPerStudent для баланса игры
   - Настройте timeBonusThreshold под размер уровня
   - Измените timeBonus для мотивации быстрого прохождения

3. Улучшение обратной связи:
   - Добавьте звуковые эффекты при получении очков
   - Используйте анимации для отображения бонусов
   - Показывайте промежуточные результаты уровня 